<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="个人博客"><title>conan使用简要实例 | 思渊</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.0"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/normalize/8.0.1/normalize.min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//lib.baomitu.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//lib.baomitu.com/jquery/3.4.0/jquery.min.js"></script><link rel="icon" mask="" sizes="any" href="/favicon.ico"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"><script async src="https://www.googletagmanager.com/gtag/js?id=UA-159367891-1"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-159367891-1');
</script><meta name="generator" content="Hexo 4.2.0"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">conan使用简要实例</h1><a id="logo" href="/.">思渊</a><p class="description">羁鸟恋旧林，池鱼思故渊</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">conan使用简要实例</h1><div class="post-meta">Feb 15, 2017<span> | </span><span class="category"><a href="/categories/C/">C++</a></span><span class="post-time"><span class="post-meta-item-text"> | </span><span class="post-meta-item-icon"><i class="fa fa-keyboard-o"></i><span class="post-count"> 1.1k</span><span class="post-meta-item-text"> 字</span></span></span><span class="post-time"> | <span class="post-meta-item-icon"><i class="fa fa-hourglass-half"></i><span class="post-count"> 4</span><span class="post-meta-item-text"> 分钟</span></span></span></div><div class="clear"><div class="toc-article" id="toc"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#前言"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#工具介绍"><span class="toc-number">2.</span> <span class="toc-text">工具介绍</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#conan使用"><span class="toc-number">3.</span> <span class="toc-text">conan使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#安装"><span class="toc-number">3.1.</span> <span class="toc-text">安装</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建项目"><span class="toc-number">3.2.</span> <span class="toc-text">创建项目</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#编译"><span class="toc-number">3.3.</span> <span class="toc-text">编译</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#配置"><span class="toc-number">3.4.</span> <span class="toc-text">配置</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#options"><span class="toc-number">3.4.1.</span> <span class="toc-text">options</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#imports"><span class="toc-number">3.4.2.</span> <span class="toc-text">imports</span></a></li></ol></li></ol></li></ol></div></div><div class="post-content"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p>在Java开发中,我们有maven做依赖管理,在PHP开发中我们有Composer做管理,Android、iOS、Python、NodeJS等等都有各自的管理工具,但是C/C++没那么幸运了,很晚才出现包管理工具.</p>
<p>在C/C++开发的时候,尤其是Linux开发.我们需要加入一些第三方的依赖,例如Openssl或者其他的一些库.之前我们或者直接在系统安装开发包;或者从源码编译,然后引用.过程是痛苦的,管理是混乱的.想我这样有不想把系统”搞脏”,又不想自己去build,急需一个工具替我进行管理,解放我的双手.</p>
<h1 id="工具介绍"><a href="#工具介绍" class="headerlink" title="工具介绍"></a>工具介绍</h1><p>在网上没有一个权威的管理工具,也许是因为C/C++太自由了吧,勉强找到两个工具一个是<a href="https://www.conan.io" target="_blank" rel="noopener">conan</a> 、一个是<a href="https://github.com/biicode/" target="_blank" rel="noopener">biicode</a>,但是biicode服务器已经关闭了,代码也是两年前的了,基本是废了,不用考虑.如果有精力的话可以折腾一下它的代码,试着自己搭建一个服务器.</p>
<p>接下来我们就试着用conan来管理我们的项目.</p>
<h1 id="conan使用"><a href="#conan使用" class="headerlink" title="conan使用"></a>conan使用</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><p>conan是用python写的,所以在安装conan之前要先安装Python,当然*nix系统自带了Python,如果是Windows用户,建议安装Python2.7, py3是异端啊!!! py的安装就不赘述了.</p>
<p>Python安装好之后执行一下代码安装</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip <span class="keyword">install</span> conan</span><br></pre></td></tr></table></figure>
<p>之后运行<code>conan</code>,输出一大堆信息表示安装成功了.</p>
<p>conan推荐用<a href="https://cmake.org/" target="_blank" rel="noopener">CMake</a>组织项目,所以,还需要下载CMake.</p>
<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><p>用官网给出的Timer例子进行示范,可以通过下面的命令获取项目</p>
<figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="keyword">clone</span> <span class="title">https</span>://github.com/memsharded/example-poco-timer.git mytimer</span><br></pre></td></tr></table></figure>

<p>或者自己在文件夹下创建三个文件<strong>timer.cpp</strong> <strong>conanfile.txt</strong> <strong>CMakeLists.txt</strong></p>
<p><strong>timer.cpp</strong></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// $Id: //poco/1.4/Foundation/samples/Timer/src/Timer.cpp#1 $</span></span><br><span class="line"><span class="comment">// This sample demonstrates the Timer and Stopwatch classes.</span></span><br><span class="line"><span class="comment">// Copyright (c) 2004-2006, Applied Informatics Software Engineering GmbH.</span></span><br><span class="line"><span class="comment">// and Contributors.</span></span><br><span class="line"><span class="comment">// SPDX-License-Identifier:     BSL-1.0</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Poco/Timer.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Poco/Thread.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"Poco/Stopwatch.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> Poco::Timer;</span><br><span class="line"><span class="keyword">using</span> Poco::TimerCallback;</span><br><span class="line"><span class="keyword">using</span> Poco::Thread;</span><br><span class="line"><span class="keyword">using</span> Poco::Stopwatch;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TimerExample</span>&#123;</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">        TimerExample()&#123; _sw.start();&#125;</span><br><span class="line"></span><br><span class="line">        <span class="function"><span class="keyword">void</span> <span class="title">onTimer</span><span class="params">(Timer&amp; timer)</span></span>&#123;</span><br><span class="line">                <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; <span class="string">"Callback called after "</span> &lt;&lt; _sw.elapsed()/<span class="number">1000</span> &lt;&lt; <span class="string">" milliseconds."</span> &lt;&lt; <span class="built_in">std</span>::<span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">        Stopwatch _sw;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">char</span>** argv)</span></span>&#123;</span><br><span class="line">        TimerExample example;</span><br><span class="line">        <span class="function">Timer <span class="title">timer</span><span class="params">(<span class="number">250</span>, <span class="number">500</span>)</span></span>;</span><br><span class="line">        timer.start(TimerCallback&lt;TimerExample&gt;(example, &amp;TimerExample::onTimer));</span><br><span class="line"></span><br><span class="line">        Thread::sleep(<span class="number">5000</span>);</span><br><span class="line">        timer.stop();</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>conanfile.txt</strong></p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">[requires]</span></span><br><span class="line">Poco/1.7.3@lasote/stable</span><br><span class="line"></span><br><span class="line"><span class="section">[generators]</span></span><br><span class="line">cmake</span><br></pre></td></tr></table></figure>
<p><strong>conanfile.txt</strong> 是用来声明依赖的,依赖可以在其官网<a href="https://www.conan.io/search?q=*" target="_blank" rel="noopener">搜索</a>,要看清相关的依赖是否支持工作的操作系统<br>文件中有四个值<code>[requires]</code>、<code>[generators]</code>、<code>[options]</code>、<code>[imports]</code></p>
<ul>
<li>[options] 用来配置包的一些属性,例如Poco:shared=True,格式为 <code>库名称:属性=值</code></li>
<li>[requires] 用来申明依赖,每一行代表一个依赖</li>
<li>[generators] 指明依赖build的工具,多数是cmake</li>
<li>[imports] 用来拷贝动态链接库</li>
</ul>
<p><strong>CMakeLists.txt</strong></p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">project</span><span class="params">(FoundationTimer)</span></span></span><br><span class="line"><span class="function"><span class="title">cmake_minimum_required</span><span class="params">(VERSION <span class="number">2.8</span>.<span class="number">12</span>)</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">include</span><span class="params">($&#123;CMAKE_BINARY_DIR&#125;/conanbuildinfo.cmake)</span></span></span><br><span class="line"><span class="function"><span class="title">conan_basic_setup</span><span class="params">()</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="title">add_executable</span><span class="params">(timer timer.cpp)</span></span></span><br><span class="line"><span class="function"><span class="title">target_link_libraries</span><span class="params">(timer $&#123;CONAN_LIBS&#125;)</span></span></span><br></pre></td></tr></table></figure>

<h2 id="编译"><a href="#编译" class="headerlink" title="编译"></a>编译</h2><p>在项目根目录新创建一个文件夹进行编译工作</p>
<figure class="highlight dos"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> build &amp;&amp; <span class="built_in">cd</span> build</span><br></pre></td></tr></table></figure>
<p>在依赖安装之前我们要查看一下我们的依赖信息</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">conan <span class="builtin-name">info</span> <span class="built_in">..</span></span><br></pre></td></tr></table></figure>
<p>如果这些依赖之前用过那么就需要我们只需要执行</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">conan</span></span> install ..</span><br></pre></td></tr></table></figure>
<p>如果有一些依赖我们之前没有没有用过,需要执行</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">conan</span></span> install .. --build lib1name lib2name ....<span class="comment">//libname表示之前没有使用过的依赖名称例如 OpenSSL等等(不需要理会 zlib 和electric-fence)</span></span><br></pre></td></tr></table></figure>

<p>因为需要对依赖进行编译,所以等待时间稍长.</p>
<p>命令执行完之后,对项目进行编译</p>
<figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="params">(win)</span></span><br><span class="line">$ cmake <span class="string">..</span> -G <span class="string">"Visual Studio 14 Win64"</span></span><br><span class="line">$ cmake <span class="params">--build</span> . <span class="params">--config</span> Release</span><br><span class="line"></span><br><span class="line"><span class="params">(linux, mac)</span></span><br><span class="line">$ cmake <span class="string">..</span> -G <span class="string">"Unix Makefiles"</span> -DCMAKE_BUILD_TYPE=Release</span><br><span class="line">$ cmake <span class="params">--build</span> .</span><br></pre></td></tr></table></figure>
<p>编译之后,执行<code>./bin/timer</code>便大功告成</p>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><h3 id="options"><a href="#options" class="headerlink" title="options"></a>options</h3><p>  如果设置库 share=ture,那么该库就会以链接的方式而不打包进可执行文件<br>  添加 conanfile.txt 如下:<br>  <figure class="highlight gradle"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">options</span>]</span><br><span class="line">Poco:shared=<span class="keyword">True</span></span><br></pre></td></tr></table></figure><br>  再次进行编译,发现这次生成的文件会比之前小很多,而且执行 <code>ldd ./bin/timer</code>, 发现可执行文件链接了一个*<em>libPocoFoundation.so.43</em>的库</p>
<h3 id="imports"><a href="#imports" class="headerlink" title="imports"></a>imports</h3>  <figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[imports]</span><br><span class="line">bin, *.dll -&gt; ./bin <span class="comment"># Copies all dll files from packages bin folder to my "bin" folder</span></span><br><span class="line"><span class="class"><span class="keyword">lib</span>, *.<span class="title">dylib</span>* -&gt; ./<span class="title">bin</span> <span class="comment"># Copies all dylib files from packages lib folder to my "bin" folder</span></span></span><br></pre></td></tr></table></figure>
<p>  用来拷贝动态链接库对Linux没用</p>
<hr>
<p>相关链接</p>
<ul>
<li><a href="http://docs.conan.io/en/latest/index.html" target="_blank" rel="noopener">conan帮助文档</a>  </li>
</ul>
</div><div class="tags"><a href="/tags/tool/">工具</a></div><div class="post-nav"><a class="next" href="/Android/java_js_bridge/">JavaJs连接桥的实现</a></div></div></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><div class="search-form"><button id="local-search-btn" type="buttion">Search</button></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/C/">C++</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/Android/" style="font-size: 15px;">Android</a> <a href="/tags/DataBinding/" style="font-size: 15px;">DataBinding</a> <a href="/tags/Kotlin/" style="font-size: 15px;">Kotlin</a> <a href="/tags/tool/" style="font-size: 15px;">工具</a> <a href="/tags/Java/" style="font-size: 15px;">Java</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/C/conan-example/">conan使用简要实例</a></li><li class="post-list-item"><a class="post-list-link" href="/Android/java_js_bridge/">JavaJs连接桥的实现</a></li><li class="post-list-item"><a class="post-list-link" href="/Android/DataBinding-kotlin-error/">解决DataBinding和kotlin共用报错的问题</a></li><li class="post-list-item"><a class="post-list-link" href="/Android/databinding-two-way/">DataBinding双向绑定</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2020 <a href="/." rel="nofollow">思渊.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div><div class="rounded" id="search-box" style="display: none;"><div class="search-form"><input id="local-search-input" type="text"><div id="local-search-result"></div></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.0" async></script><script type="text/javascript" src="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.0" async></script><link rel="stylesheet" type="text/css" href="//lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.0"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" color="0,0,0" opacity="0.5" zIndex="-2" count="50" src="//lib.baomitu.com/canvas-nest.js/2.0.4/canvas-nest.umd.js"></script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.0"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.0"></script></div></body></html>